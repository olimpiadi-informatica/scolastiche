{"version":3,"file":"2cba37dc-visualizer.js","sources":["../../../src/utils/visualizer.tsx"],"sourcesContent":["\"use client\";\n\nimport {\n  type CSSProperties,\n  Fragment,\n  type ReactNode,\n  createContext,\n  useCallback,\n  useContext,\n  useEffect,\n  useId,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\n\nimport clsx from \"clsx\";\n\ntype BoundingBox = {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n};\n\ntype ContextProps = {\n  gravity: \"top\" | \"bottom\";\n  scale: number;\n  setBoundingBox: (id: string, box: BoundingBox) => void;\n};\n\nconst VisualizerContext = createContext<ContextProps>({\n  gravity: \"top\",\n  scale: 1,\n  setBoundingBox: () => {},\n});\n\ntype CanvasProps = {\n  gravity?: \"top\" | \"bottom\";\n  scale?: number;\n  children: ReactNode;\n};\n\nexport function Canvas({ gravity = \"top\", scale = 1, children }: CanvasProps) {\n  const [objects, setObjects] = useState<Record<string, BoundingBox>>({});\n\n  const setBoundingBox = useCallback((id: string, box: BoundingBox) => {\n    setObjects((prev) => ({ ...prev, [id]: box }));\n  }, []);\n\n  const size = useMemo(() => {\n    let wMin = 0;\n    let wMax = 0;\n    let hMin = 0;\n    let hMax = 0;\n    for (const { x, y, width, height } of Object.values(objects)) {\n      wMin = Math.min(wMin, x);\n      wMax = Math.max(wMax, x + width);\n      hMin = Math.min(hMin, y);\n      hMax = Math.max(hMax, y + height);\n    }\n\n    if (gravity === \"bottom\") {\n      [hMin, hMax] = [-hMax, -hMin];\n    }\n\n    return { wMin, wMax, hMin, hMax };\n  }, [objects, gravity]);\n\n  return (\n    <VisualizerContext.Provider value={{ gravity, scale, setBoundingBox }}>\n      <div className=\"m-8\" style={{ width: size.wMax - size.wMin, height: size.hMax - size.hMin }}>\n        <div\n          className=\"relative\"\n          style={{ transform: `translate(${-size.wMin}px, ${-size.hMin}px)` }}>\n          {children}\n        </div>\n      </div>\n    </VisualizerContext.Provider>\n  );\n}\n\ntype SpriteProps = {\n  src: { src: string; width: string; height: string };\n  alt: string;\n  x?: number;\n  y?: number;\n  rotation?: number;\n  scaleX?: number;\n  scaleY?: number;\n  follow?: boolean;\n  className?: string;\n};\n\nexport function Sprite({\n  src,\n  alt,\n  x = 0,\n  y = 0,\n  rotation = 0,\n  scaleX = 1,\n  scaleY = 1,\n  follow,\n  className,\n}: SpriteProps) {\n  const id = useId();\n\n  const ref = useRef<HTMLImageElement>(null);\n  const { gravity, scale, setBoundingBox } = useContext(VisualizerContext);\n  useEffect(() => {\n    setBoundingBox(id, { x: x * scale, width: +src.width, y: y * scale, height: +src.height });\n    return () => setBoundingBox(id, { x: 0, width: 0, y: 0, height: 0 });\n  }, [x, y, src, scale, id, setBoundingBox]);\n\n  const pos = useRef({ x, y, changed: false });\n  useEffect(() => {\n    if (x !== pos.current.x || y !== pos.current.y) {\n      pos.current = { x, y, changed: true };\n    }\n\n    if (!pos.current.changed || !follow) return;\n    const id = setTimeout(() => {\n      ref.current?.scrollIntoView({\n        behavior: \"smooth\",\n        block: \"nearest\",\n        inline: \"center\",\n      });\n    }, 160);\n    return () => clearTimeout(id);\n  }, [follow, x, y]);\n\n  return (\n    <img\n      ref={ref}\n      {...src}\n      alt={alt}\n      className={clsx(\"absolute transition-all transform\", className)}\n      style={\n        {\n          [gravity]: `${y * scale}px`,\n          left: `${x * scale}px`,\n          \"--tw-rotate\": `${rotation}turn`,\n          \"--tw-scale-x\": scaleX,\n          \"--tw-scale-y\": scaleY,\n        } as CSSProperties\n      }\n    />\n  );\n}\n\ntype RectangleProps = {\n  color?: string;\n  borderColor?: string;\n  height: number;\n  width: number;\n  x?: number;\n  y?: number;\n  rotation?: number;\n  className?: string;\n  children?: ReactNode;\n};\n\nexport function Rectangle({\n  color = \"white\",\n  borderColor = \"black\",\n  height,\n  width,\n  x = 0,\n  y = 0,\n  rotation = 0,\n  className = \"\",\n  children,\n}: RectangleProps) {\n  const id = useId();\n  const { gravity, scale, setBoundingBox } = useContext(VisualizerContext);\n\n  useEffect(() => {\n    setBoundingBox(id, {\n      x: x * scale,\n      width: width * scale,\n      y: y * scale,\n      height: height * scale,\n    });\n    return () => setBoundingBox(id, { x: 0, width: 0, y: 0, height: 0 });\n  }, [x, y, width, height, scale, id, setBoundingBox]);\n\n  return (\n    <div\n      className={clsx(\"absolute transition-all transform\", className)}\n      style={\n        {\n          backgroundColor: color,\n          border: `2px solid ${borderColor}`,\n          height: `${height * scale}px`,\n          width: `${width * scale}px`,\n          [gravity]: `${y * scale}px`,\n          left: `${x * scale}px`,\n          \"--tw-rotate\": `${rotation}turn`,\n        } as CSSProperties\n      }>\n      {children}\n    </div>\n  );\n}\n\nexport function Variables({ variables }: { variables: Record<string, any> }) {\n  return (\n    <div className=\"m-4 grid max-w-sm grid-cols-2 gap-y-2 text-slate-950 *:bg-orange-400 *:px-4 *:py-1.5\">\n      {Object.entries(variables).map(([name, value]) => (\n        <Fragment key={name}>\n          <div className=\"rounded-l-2xl\">{name}</div>\n          <div className=\"rounded-r-2xl\">\n            <div className=\"rounded-lg bg-white px-2\">{Number.isFinite(value) ? value : \"-\"}</div>\n          </div>\n        </Fragment>\n      ))}\n    </div>\n  );\n}\n"],"names":["VisualizerContext","createContext","Canvas","gravity","scale","children","objects","setObjects","useState","setBoundingBox","useCallback","id","box","prev","size","useMemo","wMin","wMax","hMin","hMax","x","y","width","height","jsx","Sprite","src","alt","rotation","scaleX","scaleY","follow","className","useId","ref","useRef","useContext","useEffect","pos","clsx","Rectangle","color","borderColor","Variables","variables","name","value","Fragment"],"mappings":";wHA+BA,MAAMA,EAAoBC,EAAAA,cAA4B,CACpD,QAAS,MACT,MAAO,EACP,eAAgB,IAAM,CAAC,CACzB,CAAC,EAQM,SAASC,EAAO,CAAE,QAAAC,EAAU,MAAO,MAAAC,EAAQ,EAAG,SAAAC,GAAyB,CAC5E,KAAM,CAACC,EAASC,CAAU,EAAIC,EAAA,SAAsC,CAAE,CAAA,EAEhEC,EAAiBC,EAAAA,YAAY,CAACC,EAAYC,IAAqB,CACxDL,EAACM,IAAU,CAAE,GAAGA,EAAM,CAACF,CAAE,EAAGC,CAAM,EAAA,CAC/C,EAAG,CAAE,CAAA,EAECE,EAAOC,EAAAA,QAAQ,IAAM,CACzB,IAAIC,EAAO,EACPC,EAAO,EACPC,EAAO,EACPC,EAAO,EACA,SAAA,CAAE,EAAAC,EAAG,EAAAC,EAAG,MAAAC,EAAO,OAAAC,KAAY,OAAO,OAAOjB,CAAO,EAClDU,EAAA,KAAK,IAAIA,EAAMI,CAAC,EACvBH,EAAO,KAAK,IAAIA,EAAMG,EAAIE,CAAK,EACxBJ,EAAA,KAAK,IAAIA,EAAMG,CAAC,EACvBF,EAAO,KAAK,IAAIA,EAAME,EAAIE,CAAM,EAGlC,OAAIpB,IAAY,WACd,CAACe,EAAMC,CAAI,EAAI,CAAC,CAACA,EAAM,CAACD,CAAI,GAGvB,CAAE,KAAAF,EAAM,KAAAC,EAAM,KAAAC,EAAM,KAAAC,CAAK,CAAA,EAC/B,CAACb,EAASH,CAAO,CAAC,EAGnB,OAAAqB,EAAA,IAACxB,EAAkB,SAAlB,CAA2B,MAAO,CAAE,QAAAG,EAAS,MAAAC,EAAO,eAAAK,CAAA,EACnD,SAAAe,EAAAA,IAAC,MAAI,CAAA,UAAU,MAAM,MAAO,CAAE,MAAOV,EAAK,KAAOA,EAAK,KAAM,OAAQA,EAAK,KAAOA,EAAK,IACnF,EAAA,SAAAU,EAAA,IAAC,MAAA,CACC,UAAU,WACV,MAAO,CAAE,UAAW,aAAa,CAACV,EAAK,IAAI,OAAO,CAACA,EAAK,IAAI,KAAM,EACjE,SAAAT,CAAA,CAAA,CAEL,CAAA,CACF,CAAA,CAEJ,CAcO,SAASoB,EAAO,CACrB,IAAAC,EACA,IAAAC,EACA,EAAAP,EAAI,EACJ,EAAAC,EAAI,EACJ,SAAAO,EAAW,EACX,OAAAC,EAAS,EACT,OAAAC,EAAS,EACT,OAAAC,EACA,UAAAC,CACF,EAAgB,CACd,MAAMrB,EAAKsB,EAAAA,QAELC,EAAMC,SAAyB,IAAI,EACnC,CAAE,QAAAhC,EAAS,MAAAC,EAAO,eAAAK,CAAe,EAAI2B,EAAAA,WAAWpC,CAAiB,EACvEqC,EAAAA,UAAU,KACR5B,EAAeE,EAAI,CAAE,EAAGS,EAAIhB,EAAO,MAAO,CAACsB,EAAI,MAAO,EAAGL,EAAIjB,EAAO,OAAQ,CAACsB,EAAI,OAAQ,EAClF,IAAMjB,EAAeE,EAAI,CAAE,EAAG,EAAG,MAAO,EAAG,EAAG,EAAG,OAAQ,CAAG,CAAA,GAClE,CAACS,EAAGC,EAAGK,EAAKtB,EAAOO,EAAIF,CAAc,CAAC,EAEzC,MAAM6B,EAAMH,EAAAA,OAAO,CAAE,EAAAf,EAAG,EAAAC,EAAG,QAAS,GAAO,EAC3CgB,OAAAA,EAAAA,UAAU,IAAM,CAKd,IAJIjB,IAAMkB,EAAI,QAAQ,GAAKjB,IAAMiB,EAAI,QAAQ,KAC3CA,EAAI,QAAU,CAAE,EAAAlB,EAAG,EAAAC,EAAG,QAAS,KAG7B,CAACiB,EAAI,QAAQ,SAAW,CAACP,EAAQ,OAC/BpB,MAAAA,EAAK,WAAW,IAAM,CAC1BuB,EAAI,SAAS,eAAe,CAC1B,SAAU,SACV,MAAO,UACP,OAAQ,QAAA,CACT,GACA,GAAG,EACC,MAAA,IAAM,aAAavB,CAAE,CAC3B,EAAA,CAACoB,EAAQX,EAAGC,CAAC,CAAC,EAGfG,EAAA,IAAC,MAAA,CACC,IAAAU,EACC,GAAGR,EACJ,IAAAC,EACA,UAAWY,EAAK,oCAAqCP,CAAS,EAC9D,MACE,CACE,CAAC7B,CAAO,EAAG,GAAGkB,EAAIjB,CAAK,KACvB,KAAM,GAAGgB,EAAIhB,CAAK,KAClB,cAAe,GAAGwB,CAAQ,OAC1B,eAAgBC,EAChB,eAAgBC,CAClB,CAAA,CAAA,CAIR,CAcO,SAASU,EAAU,CACxB,MAAAC,EAAQ,QACR,YAAAC,EAAc,QACd,OAAAnB,EACA,MAAAD,EACA,EAAAF,EAAI,EACJ,EAAAC,EAAI,EACJ,SAAAO,EAAW,EACX,UAAAI,EAAY,GACZ,SAAA3B,CACF,EAAmB,CACjB,MAAMM,EAAKsB,EAAAA,QACL,CAAE,QAAA9B,EAAS,MAAAC,EAAO,eAAAK,CAAe,EAAI2B,EAAAA,WAAWpC,CAAiB,EAEvEqC,OAAAA,EAAAA,UAAU,KACR5B,EAAeE,EAAI,CACjB,EAAGS,EAAIhB,EACP,MAAOkB,EAAQlB,EACf,EAAGiB,EAAIjB,EACP,OAAQmB,EAASnB,CAAA,CAClB,EACM,IAAMK,EAAeE,EAAI,CAAE,EAAG,EAAG,MAAO,EAAG,EAAG,EAAG,OAAQ,CAAG,CAAA,GAClE,CAACS,EAAGC,EAAGC,EAAOC,EAAQnB,EAAOO,EAAIF,CAAc,CAAC,EAGjDe,EAAA,IAAC,MAAA,CACC,UAAWe,EAAK,oCAAqCP,CAAS,EAC9D,MACE,CACE,gBAAiBS,EACjB,OAAQ,aAAaC,CAAW,GAChC,OAAQ,GAAGnB,EAASnB,CAAK,KACzB,MAAO,GAAGkB,EAAQlB,CAAK,KACvB,CAACD,CAAO,EAAG,GAAGkB,EAAIjB,CAAK,KACvB,KAAM,GAAGgB,EAAIhB,CAAK,KAClB,cAAe,GAAGwB,CAAQ,MAC5B,EAED,SAAAvB,CAAA,CAAA,CAGP,CAEgB,SAAAsC,EAAU,CAAE,UAAAC,GAAiD,CAC3E,OACGpB,EAAAA,IAAA,MAAA,CAAI,UAAU,uFACZ,gBAAO,QAAQoB,CAAS,EAAE,IAAI,CAAC,CAACC,EAAMC,CAAK,WACzCC,EAAAA,SACC,CAAA,SAAA,CAACvB,EAAA,IAAA,MAAA,CAAI,UAAU,gBAAiB,SAAKqB,EAAA,EACpCrB,EAAA,IAAA,MAAA,CAAI,UAAU,gBACb,eAAC,MAAI,CAAA,UAAU,2BAA4B,SAAA,OAAO,SAASsB,CAAK,EAAIA,EAAQ,GAAI,CAAA,EAClF,CAAA,GAJaD,CAKf,CACD,CACH,CAAA,CAEJ"}