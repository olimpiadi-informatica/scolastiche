import _ from "lodash";

export const N = 10;
export const M = 17;
export const edges = [
  [0, 1],
  [1, 2],
  [2, 3],
  [3, 4],
  [4, 5],
  [5, 0],
  [0, 6],
  [5, 6],
  [6, 7],
  [7, 1],
  [7, 4],
  [1, 4],
  [1, 8],
  [4, 8],
  [8, 9],
  [9, 2],
  [9, 3],
];

export function buildVariant({ i: ii, labels, good_path, bad_path, P, Q, R }) {
    const adj = Array(N).fill(0).map(x => []);

    for (let i = 0; i < M; i++) {
        adj[edges[i][0]].push([edges[i][1], labels[i]]);
        adj[edges[i][1]].push([edges[i][0], labels[i]]);
    }

    let ans1 = 0, ans2 = 0;

    const cc = [];
    const vis_glob = Array(N).fill(false);

    for (let i = 0; i < N; i++) {
        let vis = Array(N).fill(false);
        vis[i] = true;
        for (let j = 0; j < N; j++) {
            for (let n = 0; n < N; n++) {
                if (!vis[n]) continue;
                for (const [e, w] of adj[n]) {
                    if (w == 1) vis[e] = true;
                }
            }
        }

        const card = _.sum(vis);
        ans1 += card - 1;
        if (!vis_glob[i]) {
            for (let j = 0; j < N; j++) {
                if (vis[j]) vis_glob[j] = true;
            }
            cc.push(card);
        }
    }

    ans1 /= 2;

    const cc_special = [];
    const vis_glob_special = Array(N).fill(false);

    for (let i = 0; i < N; i++) {
        let vis = Array(N).fill(false);
        vis[i] = true;
        for (let j = 0; j < N; j++) {
            for (let n = 0; n < N; n++) {
                if (!vis[n]) continue;
                for (const [e, w] of adj[n]) {
                    for (const [ee, ww] of adj[e]) {
                        if (w == ww) vis[ee] = true;
                    }
                }
            }
        }

        const card = _.sum(vis);
        ans2 += card - 1;
        if (!vis_glob_special[i]) {
            for (let j = 0; j < N; j++) {
                if (vis[j]) vis_glob_special[j] = true;
            }
            cc_special.push(card);
        }
    }

    ans2 /= 2;

    const asy = `int[] labels = { ${labels} };`;
    
    return {
        i: ii,
        ans1,
        ans2,
        good_path,
        bad_path,
        P,
        Q,
        R,
        cc,
        cc_special,
        sum_fracs: cc.map(x => `\\frac{${x} \\cdot (${x} - 1)}{2}`).join(" + "),
        sum_fracs_special: cc_special.map(x => `\\frac{${x} \\cdot (${x} - 1)}{2}`).join(" + "),
    };

}

export const variants = [
  buildVariant({
    i: 0,
    labels: [1, 2, 1, 3, 1, 2, 3, 1, 1, 3, 1, 2, 1, 3, 1, 2, 3],
    good_path: "JDEBC",
    bad_path: "GABIE",
    P: "B",
    Q: "J",
    R: "C",
  }),
  buildVariant({
    i: 1,
    labels: [2, 2, 2, 1, 3, 1, 1, 1, 1, 2, 3, 1, 3, 3, 1, 3, 2],
    good_path: "FEHBC",
    bad_path: "CDEBA",
    P: "A",
    Q: "H",
    R: "B",
  }),
  buildVariant({
    i: 2,
    labels: [3, 1, 2, 2, 2, 1, 3, 3, 1, 2, 3, 1, 1, 1, 1, 3, 2],
    good_path: "AGFED",
    bad_path: "JCDEH",
    P: "F",
    Q: "D",
    R: "E",
  }),
];

La città di Remontagna ha $10$ piazze collegate da strade a doppio senso.

Nella figura qui sotto, le piazze sono rappresentate da cerchi. A ciascuna piazza è associata una lettera dell'alfabeto da $\textsf{A}$ a $\textsf{J}$, in modo univoco.

Le strade sono di tre tipi:

- _vie_, evidenziate in linea continua rossa nella figura;
- _viali_, evidenziati in doppia linea verde nella figura;
- _sentieri_, evidenziati in linea tratteggiata blu nella figura.

![La mappa di Remontagna](city.asy)

1. Quante sono le coppie di piazze **distinte** che sono raggiungibili l'una dall'altra **usando solo vie** (strade in linea continua rossa)? Le coppie si intendono **non ordinate**: ad esempio, le coppie $(\textsf{A}, \, \textsf{B})$ e $(\textsf{B}, \, \textsf{A})$ vanno contate una sola volta.

?> {ans1}

> La risposta è **{ans1}**.
>
> Le piazze si possono dividere in gruppi tali che due piazze sono nello stesso gruppo se e solo se si possono raggiungere l'una dall'altra solo attraverso vie. (In gergo algoritmico, si dice che la città è un _grafo_ e i gruppi di piazze sono _componenti connesse_.) In questo caso, ci sono $\js{cc.length}$ gruppi contenenti, rispettivamente, $\js{cc.join(", \\,")}$ piazze.
>
> Si tratta ora di contare le coppie di piazze che appartengono allo stesso gruppo. Se un gruppo contiene $x$ piazze, le possibili coppie in quel gruppo sono $\frac{x \cdot (x - 1)}{2}$: infatti, per ogni piazza ci sono $x - 1$ altre piazze con cui si può formare una coppia; ma così facendo ogni coppia viene contata due volte, e quindi bisogna dimezzare.
>
> La risposta è quindi $\js{sum_fracs} = \js{ans1}$.
>
> ![Statistiche risposte]({i}-0.svg)

---

Un _bel percorso_ è un percorso formato da un numero **pari** di strade con la seguente proprietà: le prime due strade sono dello stesso tipo; la terza e la quarta strada sono dello stesso tipo; e così via, fino alle ultime due strade che sono anch'esse dello stesso tipo. Nota che un _bel percorso_ può passare più volte per alcune strade e piazze.

Ad esempio, un bel percorso è $\textsf{\js{good_path}}$, ovvero quello che parte dalla piazza $\textsf{\js{good_path[0]}}$, passa per le piazze $\textsf{\js{good_path[1]}}$, $\textsf{\js{good_path[2]}}$, $\textsf{\js{good_path[3]}}$ e arriva alla piazza $\textsf{\js{good_path[4]}}$. Infatti passa per $4$ strade, delle quali le prime due sono sentieri e le ultime due sono viali.

Al contrario, $\textsf{\js{bad_path}}$ **non** è un bel percorso, poiché le prime due strade non sono dello stesso tipo.

2. Quante sono le coppie di piazze **distinte** che si possono raggiungere l'una dall'altra attraverso un bel percorso? Anche in questo caso, indendiamo le coppie come **non ordinate**. Stavolta si possono usare tutti i tipi di strade.

?> {ans2}

> La risposta è **{ans2}**.
>
> Immaginiamo di aggiungere della strade _speciali_. Una strada speciale collega due piazze che possono essere raggiunte l'una dall'altra percorrendo **esattamente** due strade normali dello stesso tipo (cioè due vie, due viali o due sentieri). Le strade speciali sono mostrate in figura:
>
> ![Strade speciali evidenziate sulla mappa](special-roads.asy)
>
> Ad esempio, c'è una strada speciale che collega le piazze $\textsf{\js{P}}$ e $\textsf{\js{Q}}$ perché si possono raggiungere l'una dall'altra attraversando due viali (e la piazza $\textsf{\js{R}}$).
>
> Notiamo che un bel percorso non è altro che un percorso costituito da strade speciali. Quindi, il problema a cui ci siamo ridotti è lo stesso della prima parte, dove però consideriamo le strade speciali invece delle vie. I gruppi di piazze, in questo caso, sono formati da $\js{cc_special.join(", \\,")}$ piazze, e la risposta è $\js{sum_fracs_special} = \js{ans2}$.
>
> ![Statistiche risposte]({i}-1.svg)
